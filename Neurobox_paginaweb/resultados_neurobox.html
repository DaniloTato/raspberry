<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>Base de datos</title>
    <link rel="stylesheet" href="estilos.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        #filters {
            margin-bottom: 20px;
        }
        #filters input {
            margin-right: 10px;
        }
        #chart-container {
            width: 80%;
            margin: auto;
        }
    </style>
</head>
<body>
    <div id="Container">
        <header>
            <h1>Resultados</h1>
        </header>

        <nav>
            <ul>
                <li><a href="Html_neurobox.html">Inicio</a></li>
                <li><a href="#graficas">Gráficas</a></li>
                <li><a href="#Basededatosfea">Base de datos</a></li>
            </ul>
        </nav>
        
        <div class="clearfix"></div>
        <section id="Content">
            <!-- Gráficas -->
            <article class="article" id="graficas">
                <h2>Gráficas</h2>
                <div id="filters">
                    <label for="filter-paciente">ID Paciente:</label>
                    <input id="filter-paciente" type="text" placeholder="Ej: 1" />
                    
                    <label for="filter-juego">ID Juego:</label>
                    <input id="filter-juego" type="text" placeholder="Ej: 4" />
                    
                    <button onclick="updateChart()">Actualizar Gráfica</button>
                </div>
                <div id="chart-container">
                    <canvas id="scoreChart"></canvas>
                </div>
            </article>

            <!-- Base de datos -->
            <article class="article" id="Basededatosfea">
                <h2>Base de datos combinada</h2>
                <div id="filtros-container">
                    <label for="filter-id-juego">ID Juego:</label>
                    <input id="filter-id-juego" type="text" oninput="filterTable()" />

                    <label for="filter-id-paciente">ID Paciente:</label>
                    <input id="filter-id-paciente" type="text" oninput="filterTable()" />

                    <label for="filter-id-especialista">ID Especialista:</label>
                    <input id="filter-id-especialista" type="text" oninput="filterTable()" />

                    <label for="filter-id-resultado">ID Resultado:</label>
                    <input id="filter-id-resultado" type="text" oninput="filterTable()" />
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ID Paciente</th>
                                <th>Nombre del Paciente</th>
                                <th>Edad del Paciente</th>
                                <th>Nombre del Tutor</th>
                                <th>Edad del Tutor</th>
                                <th>Correo del Tutor</th>
                                <th>ID Especialista</th>
                                <th>Nombre del Especialista</th>
                                <th>Correo del Especialista</th>
                                <th>ID Juego</th>
                                <th>Nombre del Juego</th>
                                <th>Propósito del Juego</th>
                                <th>Duración del Juego</th>
                                <th>Fecha del Juego</th>
                                <th>ID Resultado</th>
                                <th>Puntuación</th>
                                <th>Tipo</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Datos dinámicos -->
                        </tbody>
                    </table>
                </div>
            </article>
        </section>

        <aside>
            <h3>Filtros rápidos</h3>
            <form>
                <input type="text" placeholder="Filtrar por ID Paciente" id="quick-filter-paciente">
                <input type="text" placeholder="Filtrar por Nombre del Juego" id="quick-filter-juego">
                <input type="submit" value="Aplicar filtros">
            </form>
        </aside>
    </div>


</div>

<script>
    // Filtrar tabla basado en inputs
    function filterTable() {
        const idJuego = document.getElementById('filter-id-juego').value.toLowerCase();
        const idPaciente = document.getElementById('filter-id-paciente').value.toLowerCase();
        const idEspecialista = document.getElementById('filter-id-especialista').value.toLowerCase();
        const idResultado = document.getElementById('filter-id-resultado').value.toLowerCase();

        const table = document.querySelector("table tbody");
        const rows = table.querySelectorAll("tr");

        rows.forEach(row => {
            const cells = row.querySelectorAll("td");
            const matchJuego = cells[9]?.textContent.toLowerCase().includes(idJuego);
            const matchPaciente = cells[0]?.textContent.toLowerCase().includes(idPaciente);
            const matchEspecialista = cells[6]?.textContent.toLowerCase().includes(idEspecialista);
            const matchResultado = cells[14]?.textContent.toLowerCase().includes(idResultado);

            row.style.display = matchJuego && matchPaciente && matchEspecialista && matchResultado ? "" : "none";
        });
    }
</script>
        </section>

        <footer>
            <nav>
                <ul>
                    <li><a href="contactos.html">Contactos</a></li>
                </ul>
            </nav>
        </footer>
    </div>

    <script>
        let chart;

        // Configurar la gráfica
        function setupChart() {
            const ctx = document.getElementById('scoreChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [], // Fechas
                    datasets: [{
                        label: 'Puntuación',
                        data: [], // Puntuaciones
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 2,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Fecha del Juego'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Puntuación'
                            }
                        }
                    }
                }
            });
        }

        // Actualizar la gráfica con los filtros
        function updateChart() {
            const pacienteId = document.getElementById('filter-paciente').value.trim();
            const juegoId = document.getElementById('filter-juego').value.trim();

            if (!pacienteId || !juegoId) {
                alert('Por favor, ingresa el ID del paciente y del juego.');
                return;
            }

            fetch(`http://192.168.1.79:5000/scores?paciente=${pacienteId}&juego=${juegoId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        alert(data.error);
                        return;
                    }

                    // Actualizar datos de la gráfica
                    const fechas = data.map(d => d.Fecha_Juego);
                    const puntuaciones = data.map(d => d.Puntuacion_Resultado);

                    chart.data.labels = fechas;
                    chart.data.datasets[0].data = puntuaciones;
                    chart.update();
                })
                .catch(error => {
                    console.error('Error al cargar los datos:', error);
                    alert('Hubo un error al cargar los datos.');
                });
        }

        // Inicializar la gráfica
        document.addEventListener('DOMContentLoaded', setupChart);
    </script>
</body>
</html>
